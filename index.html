<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache, no-store">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Next Launch</title>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link href='http://fonts.googleapis.com/css?family=Orbitron:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="./static/style/telegrama.css">
    <link rel="stylesheet" href="./static/style/nextlaunch.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
    <div class="container cf">
        <div class="cellophane cf">
            <div class="entity-container cf" >
                <div class="entity-row with-space"><div class="full-cell sub-heading"><i class="fa fa-rocket"></i>  Next Launch</div></div>
                <div class="entity-row with-space"><div class="full-cell big-formatted" id="launch_title"><i class="fa fa-rocket"></i></div></div>
                <div class="entity-row with-space"><div class="full-cell clock" id="launch_countdown">&nbsp;</div></div>
                <div class="entity-row with-space"><div class="full-cell formatted" id="launch_description"></div></div>
            </div>
        </div>
    </div>
    <script>
        function selectBackground(){
            var images = [
                'http://www.nasa.gov/images/content/214569main_image_1028_1600-1200.jpg',
                'http://www.jpl.nasa.gov/spaceimages/images/wallpaper/PIA17563-1920x1200.jpg',
                'http://www.nasa.gov/images/content/473892main_1736_full.jpg',
                'http://photojournal.jpl.nasa.gov/jpeg/PIA08040.jpg',
                'http://www.nasa.gov/centers/marshall/images/content/747383main_ngc6240_3600x3000.jpg',
                'http://photojournal.jpl.nasa.gov/jpeg/PIA10181.jpg',
                'http://www.nasa.gov/images/content/65076main_ISS_ivan_0913_full.jpg',
                'http://www.nasa.gov/externalflash/universe-200705/hi-resjpgs/4.jpg',
                'http://photojournal.jpl.nasa.gov/jpeg/PIA17011.jpg',
                'http://www.nasa.gov/sites/default/files/thumbnails/image/magnetar_burst_torsional_waves_4096.jpg'
            ];
            var index = Math.floor(Math.random() * images.length);
            console.log(index);
            $('body').css('background-image','url('+images[index]+')');
        }

        function getNextLaunch(){
            var self = this;
            var url = 'http://www.nasa.gov/ws/next_launch.jsonp?format_output=1&display_id=page_1&calendar_name=Launch%20Calendar&start=Sat%20Apr%2011%202015&callback=?';
            $.getJSON(
                url
            ).done(function(launch){
                $('#launch_title').html(launch.nodes[0].node.title);
                $('#launch_description').html(launch.nodes[0].node.description);
                startClock(launch.nodes[0].node.start);
            });
        }

        function startClock(launchTimeString){
            var launchTime = Date.parse(launchTimeString.replace(/-/g, "/"))/1000;
            var launchCountdown = setInterval(clock, 1000);
            function clock(){
                var now = new Date().getTime() / 1000;
                var secondsLeft = launchTime - now;
                if(secondsLeft<0){
                    clearInterval(launchCountdown);
                    return;
                }
                var secondsInDay = 24*60*60;
                var secondsInHour = 60*60;
                var secondsInMinute = 60;
                var days = parseInt(secondsLeft / (24*60*60));
                var hours = parseInt((secondsLeft % secondsInDay) / secondsInHour);
                var minutes = parseInt((secondsLeft % secondsInHour) / secondsInMinute);
                var seconds = parseInt((secondsLeft % secondsInMinute));
                hours = '00'+hours
                var daysLabel = (days==1)?' day - ':' days - ';
                var formattedTimeLeft = days+' - '+pad(hours)+':'+pad(minutes)+':'+pad(seconds);
                $('#launch_countdown').html(formattedTimeLeft);
            }
        }
        
        function pad(i){
            return ('00'+i).substr(('00'+i).length-2);
        }

        function start(){
            selectBackground();
            getNextLaunch();
        }
        
        $().ready(start);
    </script>
</body>

</html>